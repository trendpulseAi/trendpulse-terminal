<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendPulse AI | Terminal</title>
    <style>
        body { background-color: #0d1117; color: #ffffff; font-family: 'Courier New', monospace; margin: 0; padding: 20px; }
        .container { max_width: 800px; margin: 0 auto; }
        h1 { text-align: center; color: #00ff88; text-shadow: 0 0 10px rgba(0,255,136,0.5); }
        .status-bar { background: #161b22; padding: 10px; border-radius: 5px; margin-bottom: 20px; text-align: center; border: 1px solid #30363d; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 15px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); border-color: #58a6ff; }
        .pair-title { font-size: 1.2em; font-weight: bold; display: flex; justify-content: space-between; }
        .price { color: #8b949e; font-size: 0.9em; }
        .signal-box { margin-top: 15px; padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; font-size: 1.2em; }
        .call { background: rgba(0, 255, 136, 0.1); color: #00ff88; border: 1px solid #00ff88; }
        .put { background: rgba(255, 68, 68, 0.1); color: #ff4444; border: 1px solid #ff4444; }
        .wait { background: #21262d; color: #8b949e; border: 1px solid #30363d; }
        .progress-container { margin-top: 15px; background: #30363d; height: 10px; border-radius: 5px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; transition: width 1s ease-in-out; }
        .high-acc { background: linear-gradient(90deg, #00ff88, #00cc66); }
        .med-acc { background: linear-gradient(90deg, #ffdd00, #ffaa00); }
        #login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #0d1117; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #30363d; background: #0d1117; color: white; width: 250px; text-align: center; }
        button { padding: 10px 20px; background: #238636; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 10px; }
        button:hover { background: #2ea043; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div>
        <h2>üîë TrendPulse Security</h2>
        <input type="text" id="licenseKey" placeholder="Enter License Key (TP-XXXX)">
        <button onclick="login()">Connect</button>
        <p id="error-msg" style="color: #ff4444; margin-top: 10px; font-size: 0.8em;"></p>
    </div>
</div>

<div class="container">
    <h1>‚ö° TrendPulse AI Terminal</h1>
    <div class="status-bar">
        Status: <span id="connection-status" style="color: orange;">Connecting...</span> | IP: Secured
    </div>
    <div id="grid" class="grid">
        <!-- Cards injected here -->
    </div>
</div>

<script>
    // CONFIG: REPLACE THIS WITH YOUR VPS IP
    const API_URL = "https://45ba-172-98-22-201.ngrok-free.app/api/signals"; 

    let userKey = localStorage.getItem('tp_license_key');
    if(userKey) document.getElementById('licenseKey').value = userKey;

    async function login() {
        const key = document.getElementById('licenseKey').value.trim();
        const btn = document.querySelector('button');
        const err = document.getElementById('error-msg');

        btn.textContent = "Verifying...";
        err.textContent = "";

        try {
            const response = await fetch(API_URL, {
    method: "GET",
    headers: {
        "ngrok-skip-browser-warning": "69420"
    }
});

            if (response.status === 200) {
                localStorage.setItem('tp_license_key', key);
                document.getElementById('login-overlay').style.display = 'none';
                startDataStream(key);
            } else {
                const data = await response.json();
                err.textContent = data.error || "Access Denied";
                btn.textContent = "Connect";
            }
        } catch (e) {
            err.textContent = "Connection Error (Is VPS Online?)";
            btn.textContent = "Connect";
        }
    }

    function startDataStream(key) {
        document.getElementById('connection-status').innerHTML = "Live <span style='color:#00ff88'>‚óè</span>";

        setInterval(async () => {
            try {
                const res = await fetch(`${API_URL}?key=${key}`);
                const data = await res.json();
                renderGrid(data);
            } catch (e) {
                document.getElementById('connection-status').innerHTML = "Offline <span style='color:red'>‚óè</span>";
            }
        }, 1000);
    }

    function renderGrid(pairs) {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";

        pairs.forEach(p => {
            let signalClass = p.signal === 'CALL' ? 'call' : (p.signal === 'PUT' ? 'put' : 'wait');
            let barClass = p.accuracy > 75 ? 'high-acc' : 'med-acc';

            grid.innerHTML += `
                <div class="card">
                    <div class="pair-title">
                        ${p.pair}
                        <span class="price">${p.price}</span>
                    </div>
                    <div class="signal-box ${signalClass}">
                        ${p.signal === 'NONE' ? 'WAITING...' : p.signal}
                    </div>
                    <div style="margin-top:10px; font-size:0.8em; color:#8b949e;">Win Probability: ${p.accuracy}%</div>
                    <div class="progress-container">
                        <div class="progress-bar ${barClass}" style="width: ${p.accuracy}%"></div>
                    </div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
